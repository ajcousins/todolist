(()=>{"use strict";const t=function(t,e,i){let n,d;if(t||e)n=t,d=t;else{n=document.querySelector("#content");let t=document.getElementById("newTaskButton");n.removeChild(t),d=document.createElement("li"),n.appendChild(d)}d.setAttribute("class","addNewItemExpand");let o=document.createElement("input");o.setAttribute("class","main"),o.setAttribute("type","text"),d.appendChild(o);let l=document.createElement("label");l.textContent="Due Date",d.appendChild(l);let s=new Date;s=s.toISOString().slice(0,10);let c=document.createElement("input");c.setAttribute("class","date"),c.setAttribute("type","date"),c.setAttribute("placeholder","Date"),d.appendChild(c);let r=document.createElement("label");r.textContent="Priority",d.appendChild(r);let a=document.createElement("select");a.setAttribute("class","priority"),d.appendChild(a);let u=document.createElement("option");u.setAttribute("value","High"),u.textContent="High",e&&"High"===e.priority&&u.setAttribute("selected","selected"),a.appendChild(u);let p=document.createElement("option");p.setAttribute("value","Medium"),p.textContent="Medium",e&&"Medium"===e.priority&&p.setAttribute("selected","selected"),a.appendChild(p);let m=document.createElement("option");m.setAttribute("value","Low"),m.textContent="Low",e&&"Low"===e.priority&&m.setAttribute("selected","selected"),a.appendChild(m);let L=document.createElement("br");d.appendChild(L);let h=document.createElement("textarea");h.setAttribute("class","notes"),h.setAttribute("rows","4"),h.setAttribute("cols","50"),h.setAttribute("placeholder","Notes"),d.appendChild(h);let v=document.createElement("div");v.setAttribute("class","formButtonContainer"),d.appendChild(v);let E=document.createElement("div");E.setAttribute("class","addButton"),E.textContent="Cancel",v.appendChild(E);let C=document.createElement("div");C.setAttribute("class","addButton"),v.appendChild(C),e?(o.setAttribute("id",`titleInputEdit-${i}`),o.setAttribute("value",`${e.title}`),c.setAttribute("id",`dateDueEdit-${i}`),c.setAttribute("value",`${e.dateDue}`),a.setAttribute("id",`priorityEdit-${i}`),h.setAttribute("id",`notesEdit-${i}`),h.innerHTML=`${e.notes}`,C.setAttribute("id",`editSubmit-${i}`),E.setAttribute("id",`editCancel-${i}`),C.textContent="Update",document.getElementById(`titleInputEdit-${i}`).focus()):(o.setAttribute("id","titleInput"),c.setAttribute("id","dateDue"),c.setAttribute("value",`${s}`),a.setAttribute("id","priority"),h.setAttribute("id","notes"),C.setAttribute("id","submit"),E.setAttribute("id","cancel"),C.textContent="Add",document.getElementById("titleInput").focus())},e=function(t){const e=t.projectsList,i=t.activeProjectIndex,n=document.querySelector(".projectWrapper");n.innerHTML="";for(let t=0;t<e.length;t++){let d=document.createElement("div");d.setAttribute("class","projectButton"),d.textContent=e[t].projectTitle,i===t&&d.classList.add("pressed"),n.appendChild(d)}},i=function(t,e,i){const n=t,d=e.dateDue,o=`${d[8]}${d[9]}/${d[5]}${d[6]}/${d[2]}${d[3]}`;let l=document.createElement("div");l.classList.add("listLower");let s=document.createElement("div");s.classList.add("dueDate"),s.innerHTML=`<em>Date: </em>${o}`;let c=document.createElement("div");c.classList.add("priority"),c.innerHTML=`<em>Priority: </em>${e.priority}`,l.appendChild(s),l.appendChild(c),n.appendChild(l);let r=document.createElement("div");r.classList.add("listLower");let a=document.createElement("div");a.classList.add("notes"),a.innerHTML=`${e.notes}`,r.appendChild(a),n.appendChild(r);let u=document.createElement("div");u.classList.add("listLower");let p=document.createElement("div");p.classList.add("editButton"),p.id=`edit-${i}`,p.textContent="Edit";let m=document.createElement("div");m.classList.add("deleteButton"),m.id=`del-${i}`,m.textContent="Delete",u.appendChild(p),u.appendChild(m),n.appendChild(u)},n={projectsList:[],activeProjectIndex:0,add:function(t){this.projectsList.push(t)},delete:function(t){this.projectsList.splice(t,1)},activeProjectName:function(){return this.projectsList[this.activeProjectIndex].projectTitle}};class d{constructor(t){this.projectTitle=t,this.itemList=[]}add(t){this.itemList.push(t)}delete(t){this.itemList.splice(t,1)}update(t,e){this.itemList.splice(e,1,t)}markAsDone(t){this.itemList[t].changeStatus()}sortItemsByDate(){this.itemList=this.itemList.sort(((t,e)=>parseInt(t.dateDue.split("-").join(""))>parseInt(e.dateDue.split("-").join(""))?1:-1))}sortItemsByPriority(){this.itemList=this.itemList.sort(((t,e)=>{let i,n;switch(t.priority){case"High":i=3;break;case"Medium":i=2;break;case"Low":i=1}switch(e.priority){case"High":n=3;break;case"Medium":n=2;break;case"Low":n=1}return i<n?1:-1}))}}class o{constructor(t,e,i,n,d){this.title=t,this.notes=e,this.dateDue=i,this.priority=n,this.projectName=d,this.done=!1}changeStatus(){!1===this.done?this.done=!0:this.done=!1}}const l=new d("Default");n.add(l),function(){function s(){let t=document.querySelectorAll(".projectButton");t=Array.from(t);for(let i=0;i<t.length;i++)t[i].addEventListener("click",(()=>{n.activeProjectIndex=i,c(i),e(n),s(),m(),u()}))}function c(t){let i=document.querySelector(".upperPanel"),d=document.querySelector(".projectLabel");if(0===t)i.innerHTML="",d.textContent="To Do List",i.appendChild(d),o();else{i.innerHTML="",d.textContent=n.projectsList[t].projectTitle,i.appendChild(d),o();let l=document.createElement("div");l.classList.add("projectDeleteButton"),l.textContent="Delete",i.appendChild(l),l.addEventListener("click",(()=>{!function(){let t=n.activeProjectIndex,i=function(t,e){let i=t.projectsList[e].projectTitle,n=document.createElement("div");n.classList.add("modalBackground"),document.body.appendChild(n);let d=document.createElement("div");d.classList.add("modal");let o=document.createElement("div");o.innerHTML=`Are you sure you want to delete ${i}?<br>\n    All tasks in this project will be deleted permanently.`,o.classList.add("textBox"),d.appendChild(o);let l=document.createElement("div");l.classList.add("projectButton"),l.classList.add("modalButtons"),l.classList.add("ok"),l.textContent="OK",o.appendChild(l);let s=document.createElement("div");return s.classList.add("projectButton"),s.classList.add("modalButtons"),s.textContent="Cancel",o.appendChild(s),document.body.appendChild(d),{index:e,modalBackground:n,modal:d,okButton:l,cancelButton:s}}(n,t);i.modalBackground.addEventListener("click",(()=>{document.body.removeChild(i.modal),document.body.removeChild(i.modalBackground)})),i.okButton.addEventListener("click",(()=>{n.delete(t),localStorage.removeItem(`project-${n.activeProjectIndex}`);for(let e=0;e<localStorage.length;e++)if(!(e<t))if(console.log(e),localStorage.getItem(`project-${e}`))console.log(`project-${e} exists!`);else{let t=localStorage.getItem(localStorage.key(e));console.log(`project-${e} does not exist!`),localStorage.setItem(`project-${e}`,t)}n.activeProjectIndex=0,c(0),e(n),document.body.removeChild(i.modal),document.body.removeChild(i.modalBackground),s(),m(),u()})),i.cancelButton.addEventListener("click",(()=>{document.body.removeChild(i.modal),document.body.removeChild(i.modalBackground)}))}()}))}function o(){let t=n.activeProjectIndex,e=document.createElement("div");e.classList.add("projectSortButton"),e.textContent="Sort by Date",i.appendChild(e),e.addEventListener("click",(()=>{n.projectsList[t].sortItemsByDate(),m()}));let d=document.createElement("div");d.classList.add("projectSortButton"),d.textContent="Sort by Priority",i.appendChild(d),d.addEventListener("click",(()=>{n.projectsList[t].sortItemsByDate(),n.projectsList[t].sortItemsByPriority(),m()}))}}function r(t,e){let i,d,l,s,c,r=n.activeProjectName();if(c=void 0===e?"":`Edit-${e}`,("click"===t.type||"Enter"===t.key)&&(i=document.querySelector(`#titleInput${c}`).value,d=document.querySelector(`#notes${c}`).value,l=document.querySelector(`#dateDue${c}`).value,s=document.querySelector(`#priority${c}`).value,!i))return;let a=new o(i,d,l,s,r),u=n.activeProjectIndex;void 0===e?(n.projectsList[u].add(a),document.querySelector("#titleInput").value=""):n.projectsList[u].update(a,e),m()}function a(e,i,n){e.innerHTML="",t(e,i,n);let d=document.querySelector(`#editSubmit-${n}`),o=document.querySelector(`#editCancel-${n}`),l=document.getElementById(`titleInputEdit-${n}`);d.addEventListener("click",(t=>{r(t,n)})),o.addEventListener("click",(()=>{L()})),l.addEventListener("keypress",(function(t){"Enter"===t.key&&r(t,n)}))}function u(t){if(!t){let t=document.querySelector(".projectWrapper"),e=document.createElement("div");e.id="newProjectButton",e.classList.add("projectNewButton"),e.textContent="Add New Project",e.addEventListener("click",(()=>{t.removeChild(e);let i=function(t){let e=document.createElement("div");e.classList.add("projectNewButtonPressed"),t.appendChild(e);let i=document.createElement("input");i.setAttribute("class","projectInput"),i.setAttribute("type","text"),i.setAttribute("id","newProject"),e.appendChild(i),i.focus();let n=document.createElement("div");return n.setAttribute("class","addButton"),n.setAttribute("id","projectSubmit"),n.textContent="Add",t.appendChild(n),{input:i,buttonAdd:n}}(t);i.input.addEventListener("keypress",(function(t){if("Enter"===t.key){if(!i.input.value)return;p(i.input.value)}})),i.buttonAdd.addEventListener("click",(()=>{i.input.value&&p(i.input.value)}))})),t.appendChild(e)}}function p(t){n.activeProjectIndex=n.projectsList.length;let i=new d(t);n.add(i);let o=JSON.stringify(i);localStorage.setItem(`project-${n.activeProjectIndex}`,o),c(n.activeProjectIndex),e(n),s(),m(),u()}function m(){let e=document.querySelector("#content");e.innerHTML="";let d=n.activeProjectIndex;for(let t=0;t<n.projectsList[d].itemList.length;t++){let o=document.createElement("li");o.classList.add("listItem");let l=document.createElement("div");l.classList.add("listUpper"),l.id=`list-${t}`,l.textContent=n.projectsList[d].itemList[t].title,l.addEventListener("click",(e=>{e.path[0]===l&&(n.projectsList[d].markAsDone(t),m())})),o.appendChild(l),!0===n.projectsList[d].itemList[t].done&&l.classList.add("taskDoneText");let s=document.createElement("div");s.classList.add("pressZone");let c=document.createElement("div");c.classList.add("itemTriangle"),s.appendChild(c),l.appendChild(s);let r=document.createElement("div");r.classList.add("listLowerSecton"),o.appendChild(r),s.addEventListener("click",(()=>{if(c.classList.contains("flipped"))c.classList.remove("flipped"),r.innerHTML="";else{c.classList.add("flipped"),i(r,n.projectsList[d].itemList[t],t);let e=o.querySelector(".deleteButton");e.addEventListener("click",(()=>{let t=e.id.split("-");n.projectsList[d].delete(t[1]),m()}));let l=o.querySelector(".editButton");l.addEventListener("click",(()=>{l.id.split("-"),a(o,n.projectsList[d].itemList[t],t)}))}})),e.appendChild(o)}!function(){let e=document.querySelector("#content"),i=document.createElement("li");i.id="newTaskButton",i.classList.add("addNewItem"),i.textContent="Add new task",e.appendChild(i),i.addEventListener("click",(()=>{t(),submit.addEventListener("click",(t=>{r(t)})),cancel.addEventListener("click",(()=>L())),titleInput.addEventListener("keypress",(function(t){"Enter"===t.key&&r(t)}))}))}()}function L(){m()}e(n),s(),m(),u(),c(0),function(){if(0==localStorage.length){console.log("Empty local storage. Populating with placeholder tasks.");const t=new o("Make pancakes","Mix flour, eggs and milk in a bowl.","2021-03-11","Low","Default"),e=new o("Heat pan","First thing in the morning","2021-03-10","High","Default"),i=new o("Eat pancakes","Remember lemon and sugar.","2021-03-12","Low","Default");l.add(t),l.add(e),l.add(i);for(let t=0;t<n.projectsList.length;t++){let e=JSON.stringify(n.projectsList[t]);localStorage.setItem(`project-${t}`,e)}}else for(let t=0;t<localStorage.length;t++){let e=JSON.parse(localStorage.getItem(`project-${t}`));if(0===t)console.log("Default project");else{let t=new d(e.projectTitle);n.add(t)}console.log("deSerialised",e);for(let i=0;i<e.itemList.length;i++){let d=new o(e.itemList[i].title,e.itemList[i].notes,e.itemList[i].dateDue,e.itemList[i].priority,e.itemList[i].projectName);n.projectsList[t].add(d)}let i=JSON.stringify(n.projectsList[t]);localStorage.setItem(`project-${t}`,i)}console.log(n),e(n),s(),m(),u(),c(0)}()}()})();